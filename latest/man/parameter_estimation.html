<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Parameter Estimation · DifferentialEquations.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/default.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Ubuntu+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script></head><body><nav class="toc"><h1>DifferentialEquations.jl</h1><form class="search" action="../search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../index.html">Home</a></li><li><span class="toctext">Tutorials</span><ul><li><a class="toctext" href="../tutorials/ode_example.html">Ordinary Differential Equations (ODE)</a></li><li><a class="toctext" href="../tutorials/sde_example.html">Stochastic Differential Equations (SDE)</a></li><li><a class="toctext" href="../tutorials/dae_example.html">Differential Algebraic Equations (DAE)</a></li><li><a class="toctext" href="../tutorials/fempoisson_example.html">Poisson Equation Finite Element Method</a></li><li><a class="toctext" href="../tutorials/femheat_example.html">Heat Equation Finite Element Method</a></li><li><a class="toctext" href="../tutorials/femstochastic_example.html">Stochastic Finite Element Method</a></li></ul></li><li><span class="toctext">Problem Types</span><ul><li><a class="toctext" href="../problems/ODEProblem.html">Defining an ODE Problem</a></li><li><a class="toctext" href="../problems/SDEProblem.html">Defining a SDE Problem</a></li><li><a class="toctext" href="../problems/FEMProblem.html">Defining a FEM Problem</a></li><li><a class="toctext" href="../problems/StokesProblem.html">Defining a Stokes Problem</a></li></ul></li><li><span class="toctext">Solver Options</span><ul><li><a class="toctext" href="../solvers/common_solver_opts.html">Common Solver Options</a></li><li><a class="toctext" href="../solvers/ode_solve.html">Ordinary Differential Equation Solvers</a></li><li><a class="toctext" href="../solvers/sde_solve.html">Stochastic Differential Equation Solvers</a></li><li><a class="toctext" href="../solvers/dae_solve.html">Differential Algebraic Equation Solvers</a></li><li><a class="toctext" href="../solvers/fempoisson_solve.html">Finite Element Method Poisson Equation Solvers</a></li><li><a class="toctext" href="../solvers/femheat_solve.html">Finite Element Method Heat Equation Solvers</a></li><li><a class="toctext" href="../solvers/fdmstokes_solve.html">Finite Difference Method Stokes Equation Solvers</a></li></ul></li><li><span class="toctext">Manual</span><ul><li><a class="toctext" href="overview.html">Overview of DifferentialEquations.jl</a></li><li><a class="toctext" href="mesh.html">Meshes</a></li><li><a class="toctext" href="solution.html">The Solution Type</a></li><li><a class="toctext" href="output_specification.html">Output Specification</a></li><li><a class="toctext" href="callback_functions.html">Event Handling and Callback Functions</a></li><li><a class="toctext" href="plot.html">Plot Functions</a></li><li class="current"><a class="toctext" href="parameter_estimation.html">Parameter Estimation</a><ul class="internal"></ul></li><li><a class="toctext" href="sensitivity.html">Sensitivity Analysis</a></li><li><a class="toctext" href="function_definition_macros.html">Function Definition Macros</a></li><li><a class="toctext" href="benchmarks.html">Benchmark Suite</a></li><li><a class="toctext" href="convergence.html">Convergence Simulations</a></li><li><a class="toctext" href="conditional_dependencies.html">Conditional Dependencies</a></li><li><a class="toctext" href="progress_bar.html">Juno Progress Bar Integration</a></li></ul></li><li><span class="toctext">Internal Documentation</span><ul><li><a class="toctext" href="../internals/contributors_guide.html">Contributor&#39;s Guide</a></li><li><a class="toctext" href="../internals/fem_tools.html">Internal Finite Element Tools</a></li><li><a class="toctext" href="../internals/extras.html">Extra Functions</a></li><li><a class="toctext" href="../internals/notes_on_algorithms.html">Notes on Algorithms</a></li><li><a class="toctext" href="../internals/function_index.html">Function Index</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Manual</li><li><a href="parameter_estimation.html">Parameter Estimation</a></li></ul><a class="edit-page" href="https://github.com/JuliaDiffEq/DiffEqDocs.jl/tree/2244d01f3ae4a0aa4b31d7e3d7f311b56da668fc/docs/src/man/parameter_estimation.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/></header><h1><a class="nav-anchor" id="Parameter-Estimation-1" href="#Parameter-Estimation-1">Parameter Estimation</a></h1><p>Parameter estimation for ODE models is provided by the DiffEq suite. The current functionality includes <code>build_optim_objective</code> and <code>lm_fit</code>. Note these require that the problem is defined using a <a href="https://github.com/JuliaDiffEq/ParameterizedFunctions.jl">ParameterizedFunction</a>.</p><h3><a class="nav-anchor" id="build_optim_objective-1" href="#build_optim_objective-1">build_optim_objective</a></h3><p><code>build_optim_objective</code> builds an objective function to be used with Optim.jl.</p><pre><code class="language-julia">build_optim_objective(prob::DEProblem,tspan,t,data;loss_func = L2DistLoss,kwargs...)</code></pre><p>The first argument is the DEProblem to solve. Second is the <code>tspan</code>. Next is <code>t</code>, the set of timepoints which the data is found at. The last argument which is required is the data, which are the values where are known, in order to be optimized against. Optionally, one can choose a loss function from LossFunctions.jl or use the default of an L2 loss. The keyword arguments are passed to the ODE solver.</p><h3><a class="nav-anchor" id="build_lsoptim_objective-1" href="#build_lsoptim_objective-1">build_lsoptim_objective</a></h3><p><code>build_lsoptim_objective</code> builds an objective function to be used with LeastSquaresOptim.jl.</p><pre><code class="language-julia">build_lsoptim_objective(prob::DEProblem,tspan,t,data;kwargs...)</code></pre><p>The arguments are the same as <code>build_optim_objective</code>.</p><h3><a class="nav-anchor" id="lm_fit-1" href="#lm_fit-1">lm_fit</a></h3><p><code>lm_fit</code> is a function for fitting the parameters of an ODE using the Levenberg-Marquardt algorithm. This algorithm is really bad and thus not recommended since, for example, the Optim.jl algorithms on an L2 loss are more performant and robust. However, this is provided for completeness as most other differential equation libraries use an LM-based algorithm, so this allows one to test the increased effectiveness of not using LM.</p><pre><code class="language-julia">lm_fit(prob::DEProblem,tspan,t,data,p0;kwargs...)</code></pre><p>The arguments are similar to before, but with <code>p0</code> being the initial conditions for the parameters and the <code>kwargs</code> as the args passed to the LsqFit <code>curve_fit</code> function (which is used for the LM solver). This returns the fitted parameters.</p><h4><a class="nav-anchor" id="Examples-1" href="#Examples-1">Examples</a></h4><p>We choose to optimize the parameters on the Lotka-Volterra equation. We do so by defining the function as a <a href="https://github.com/JuliaDiffEq/ParameterizedFunctions.jl">ParmaeterizedFunction</a>:</p><pre><code class="language-julia">f = @ode_def_nohes LotkaVolterraTest begin
  dx = a*x - b*x*y
  dy = -c*y + d*x*y
end a=&gt;1.5 b=1.0 c=3.0 d=1.0

u0 = [1.0;1.0]
tspan = [0;10.0]
prob = ODEProblem(f,u0)</code></pre><p>Notice that since we only used <code>=&gt;</code> for <code>a</code>, it&#39;s the only free parameter. We create data using the numerical result with <code>a=1.5</code>:</p><pre><code class="language-julia">t = collect(linspace(0,10,200))
randomized = [(sol(t[i]) + .01randn(2)) for i in 1:length(t)]
data = vecvec_to_mat(randomized)</code></pre><p>Here we used <code>vecvec_to_mat</code> from <a href="https://github.com/ChrisRackauckas/RecursiveArrayTools.jl">RecursiveArrayTools.jl</a> to turn the result of an ODE to a matrix.</p><p>If we plot the solution with the parameter at <code>a=1.42</code>, we get the following:</p><p><img src="../assets/paramest_notfit.png" alt="Parameter Estimation Not Fit"/></p><p>Notice that after one period this solution begins to drift very far off: this problem is sensitive to the choice of <code>a</code>.</p><p>To build the objective function for Optim.jl, we simply call the <code>build_optim_objective</code> funtion:</p><pre><code class="language-julia">cost_function = build_optim_objective(prob,tspan,t,data,alg=:Vern6)</code></pre><p>Now this cost function can be used with Optim.jl in order to get the parameters. For example, we can use Brent&#39;s algorithm to search for the best solution on the interval <code>[0,10]</code> by:</p><pre><code class="language-julia">result = optimize(cost_function, 0.0, 10.0)</code></pre><p>This returns <code>result.minimum[1]==1.5</code> as the best parameter to match the data. When we plot the fitted equation on the data, we receive the following:</p><p><img src="../assets/paramest_fit.png" alt="Parameter Estimation Fit"/></p><p>Thus we see that after fitting, the lines match up with the generated data and receive the right parameter value.</p><p>We can also use the multivariate optimization functions. For example, we can use the <code>BFGS</code> algorithm to optimize the parameter starting at <code>a=1.42</code> using</p><pre><code class="language-julia">result = optimize(cost_function, [1.42], BFGS())</code></pre><p>Note that some of the algorithms may be sensitive to the initial condtion. For more details on using Optim.jl, see the <a href="http://www.juliaopt.org/Optim.jl/latest/">documentation for Optim.jl</a>.</p><footer><hr/><a class="previous" href="plot.html"><span class="direction">Previous</span><span class="title">Plot Functions</span></a><a class="next" href="sensitivity.html"><span class="direction">Next</span><span class="title">Sensitivity Analysis</span></a></footer></article></body></html>
